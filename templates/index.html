<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>7segwall</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: 'Poppins', sans-serif;
            background-color: #121212;
            color: #e0e0e0;
            overflow: hidden;
        }
        
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            padding: 10px;
            box-sizing: border-box;
        }
        
        .controls {
            flex: 0 0 auto;
            text-align: center;
            padding: 10px;
            background: #1e1e1e;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.4);
            margin-bottom: 10px;
        }
        
        .grid-container {
            flex: 1;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(5, 1fr);
            gap: 10px;
            overflow: auto;
        }
        
        .pcb-container {
            background: #2a2a2a;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.4);
            display: flex;
            flex-direction: column;
            border: 1px solid #383838;
        }
        
        .pcb-title {
            font-weight: 500;
            color: #e0e0e0;
            text-align: center;
            font-size: 0.9em;
            margin-bottom: 5px;
        }
        
        .displays-container {
            display: flex;
            justify-content: space-around;
            align-items: center;
            flex: 1;
        }
        
        .display-group {
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .display-title {
            font-size: 0.75em;
            margin-bottom: 2px;
            color: #aaaaaa;
        }
        
        .seven-segment {
            max-width: 100%;
            height: auto;
            display: inline-block;
        }
        
        .btn {
            padding: 6px 12px;
            margin: 0 3px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Poppins', sans-serif;
            transition: all 0.2s;
            font-size: 0.9em;
            background-color: #3a3a3a;
            color: #e0e0e0;
        }
        
        .btn-danger {
            background-color: #dc3545;
            color: white;
        }
        .btn-danger:hover {
            background-color: #c82333;
        }
        
        .btn-primary {
            background-color: #007bff;
            color: white;
        }
        .btn-primary:hover {
            background-color: #0056b3;
        }
        
        .btn-success {
            background-color: #28a745;
            color: white;
        }
        .btn-success:hover {
            background-color: #218838;
        }
        
        .btn-warning {
            background-color: #ffc107;
            color: #000;
        }
        .btn-warning:hover {
            background-color: #e0a800;
        }
        
        .preset-controls {
            margin-top: 10px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
        }
        
        .save-preset, .load-preset {
            display: flex;
            gap: 5px;
            align-items: center;
        }
        
        .preset-input, .preset-select {
            padding: 6px;
            border: 1px solid #444;
            border-radius: 4px;
            font-family: 'Poppins', sans-serif;
            width: 150px;
            font-size: 0.9em;
            background-color: #333;
            color: #e0e0e0;
        }
        
        .preset-input:focus, .preset-select:focus {
            outline: none;
            border-color: #0069d9;
            background-color: #3a3a3a;
        }
        
        .segment {
            fill: #333333;
            transition: fill 0.15s;
            cursor: pointer;
            stroke: #444;
            stroke-width: 1;
        }
        
        .segment:hover {
            fill: #444444;
        }
        
        .segment.on {
            fill: #ff3333;
            stroke: #ff6666;
        }
        
        .dp {
            fill: #333333;
            cursor: pointer;
            transition: fill 0.15s;
            stroke: #444;
            stroke-width: 1;
        }
        
        .dp:hover {
            fill: #444444;
        }
        
        .dp.on {
            fill: #ff3333;
            stroke: #ff6666;
        }
        
        /* Toast notification styles */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }
        
        .toast {
            padding: 12px 20px;
            margin-bottom: 10px;
            border-radius: 6px;
            color: white;
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            display: flex;
            align-items: center;
            min-width: 250px;
            max-width: 350px;
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s ease;
        }
        
        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .toast-success {
            background-color: #28a745;
            border-left: 5px solid #1e7e34;
        }
        
        .toast-error {
            background-color: #dc3545;
            border-left: 5px solid #bd2130;
        }
        
        .toast-warning {
            background-color: #ffc107;
            border-left: 5px solid #d39e00;
            color: #212529;
        }
        
        .toast-info {
            background-color: #007bff;
            border-left: 5px solid #0062cc;
        }
        
        .toast-icon {
            margin-right: 10px;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 20px;
        }
        
        .toast-message {
            flex: 1;
        }
        
        .toast-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 3px;
            background-color: rgba(255, 255, 255, 0.5);
            border-radius: 0 0 4px 4px;
            width: 100%;
            animation: progress-bar 3s linear forwards;
        }
        
        @keyframes progress-bar {
            from { width: 100%; }
            to { width: 0%; }
        }
        
        /* Responsive adjustments */
        @media (max-height: 700px) {
            .pcb-title, .display-title {
                font-size: 0.7em;
            }
            
            .btn, .preset-input, .preset-select {
                font-size: 0.8em;
                padding: 4px 8px;
            }
            
            .controls {
                padding: 5px;
            }
            
            .preset-controls {
                margin-top: 5px;
            }
        }
        
        @media (max-width: 768px) {
            .preset-controls {
                flex-direction: column;
                align-items: center;
            }
            
            .toast-container {
                top: 10px;
                right: 10px;
                left: 10px;
            }
            
            .toast {
                min-width: auto;
                max-width: none;
                width: calc(100% - 20px);
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="controls">
            <button id="clearAllBtn" class="btn btn-danger">Clear All</button>
            <button id="hoverToggleBtn" class="btn btn-primary">Enable Hover</button>
            
            <!-- Preset Controls -->
            <div class="preset-controls">
                <div class="save-preset">
                    <input type="text" id="presetName" placeholder="Preset name" class="preset-input">
                    <button id="savePresetBtn" class="btn btn-primary">Save</button>
                </div>
                <div class="load-preset">
                    <select id="presetSelect" class="preset-select">
                        <option value="">Select a preset...</option>
                        {% for preset in presets %}
                            <option value="{{ preset }}">{{ preset }}</option>
                        {% endfor %}
                    </select>
                    <button id="loadPresetBtn" class="btn btn-success">Load</button>
                    <button id="deletePresetBtn" class="btn btn-warning">Delete</button>
                </div>
            </div>
        </div>

        <div class="grid-container">
            {% set pcb_layout = [
                [1, 6, 11],
                [2, 7, 12],
                [3, 8, 13],
                [4, 9, 14],
                [5, 10, 15]
            ] %}
            
            {% for row in pcb_layout %}
                {% for pcb in row %}
                    <div class="pcb-container">
                        <div class="pcb-title">PCB {{ pcb }}</div>
                        <div class="displays-container">
                            {% set display_segments = [
                                [(0, 'A'), (1, 'B'), (2, 'C'), (3, 'D'), (4, 'E'), (5, 'F'), (6, 'G'), (7, 'DP')],
                                [(16, 'A'), (17, 'B'), (18, 'C'), (19, 'D'), (20, 'E'), (21, 'F'), (22, 'G'), (23, 'DP')],
                                [(8, 'A'), (9, 'B'), (10, 'C'), (11, 'D'), (12, 'E'), (13, 'F'), (14, 'G'), (15, 'DP')]
                            ] %}
                            
                            {% for display_index in range(3) %}
                                <div class="display-group">
                                    <div class="display-title">Display {{ display_index + 1 }}</div>
                                    <svg class="seven-segment" viewBox="0 0 120 200">
                                        <!-- Segment A (top horizontal) -->
                                        <path 
                                            class="segment" 
                                            data-pcb="{{ pcb - 1 }}" 
                                            data-segment="{{ display_segments[display_index][0][0] }}"
                                            d="M35 20L85 20L77 32L43 32L35 20"
                                        />
                                        
                                        <!-- Segment B (top right vertical) -->
                                        <path 
                                            class="segment"
                                            data-pcb="{{ pcb - 1 }}"
                                            data-segment="{{ display_segments[display_index][1][0] }}"
                                            d="M95 30L107 42L107 78L95 90L83 78L83 42L95 30"
                                        />
                                        
                                        <!-- Segment C (bottom right vertical) -->
                                        <path 
                                            class="segment"
                                            data-pcb="{{ pcb - 1 }}"
                                            data-segment="{{ display_segments[display_index][2][0] }}"
                                            d="M95 110L107 122L107 158L95 170L83 158L83 122L95 110"
                                        />
                                        
                                        <!-- Segment D (bottom horizontal) -->
                                        <path 
                                            class="segment"
                                            data-pcb="{{ pcb - 1 }}"
                                            data-segment="{{ display_segments[display_index][3][0] }}"
                                            d="M35 180L85 180L77 168L43 168L35 180"
                                        />
                                        
                                        <!-- Segment E (bottom left vertical) -->
                                        <path 
                                            class="segment"
                                            data-pcb="{{ pcb - 1 }}"
                                            data-segment="{{ display_segments[display_index][4][0] }}"
                                            d="M25 110L37 122L37 158L25 170L13 158L13 122L25 110"
                                        />
                                        
                                        <!-- Segment F (top left vertical) -->
                                        <path 
                                            class="segment"
                                            data-pcb="{{ pcb - 1 }}"
                                            data-segment="{{ display_segments[display_index][5][0] }}"
                                            d="M25 30L37 42L37 78L25 90L13 78L13 42L25 30"
                                        />
                                        
                                        <!-- Segment G (middle horizontal) -->
                                        <path 
                                            class="segment"
                                            data-pcb="{{ pcb - 1 }}"
                                            data-segment="{{ display_segments[display_index][6][0] }}"
                                            d="M35 100L43 92L77 92L85 100L77 108L43 108L35 100"
                                        />
                                        
                                        <!-- Decimal Point -->
                                        <circle 
                                            class="dp"
                                            data-pcb="{{ pcb - 1 }}"
                                            data-segment="{{ display_segments[display_index][7][0] }}"
                                            cx="105" 
                                            cy="180" 
                                            r="7"
                                        />
                                    </svg>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                {% endfor %}
            {% endfor %}
        </div>
        
        <!-- Toast container -->
        <div class="toast-container"></div>
    </div>

    <script>
        var hoverEnabled = false;

        // Toast notification function
        function showToast(message, type = 'info') {
            const toastContainer = document.querySelector('.toast-container');
            
            // Create toast element
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            
            // Set icon based on type
            let iconClass = '';
            switch(type) {
                case 'success':
                    iconClass = 'fa-solid fa-check';
                    break;
                case 'error':
                    iconClass = 'fa-solid fa-xmark';
                    break;
                case 'warning':
                    iconClass = 'fa-solid fa-triangle-exclamation';
                    break;
                default:
                    iconClass = 'fa-solid fa-info';
            }
            
            // Create toast content
            toast.innerHTML = `
                <div class="toast-icon"><i class="${iconClass}"></i></div>
                <div class="toast-message">${message}</div>
                <div class="toast-progress"></div>
            `;
            
            // Add to container
            toastContainer.appendChild(toast);
            
            // Show toast with animation
            setTimeout(() => {
                toast.classList.add('show');
            }, 10);
            
            // Remove toast after animation duration
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    toast.remove();
                }, 300);
            }, 3000);
        }

        // Toggle functionality
        $("#clearAllBtn").click(function() {
            $.post('/clear_all', {}, function(response) {
                if (response.success) {
                    $(".segment, .dp").removeClass('on');
                    showToast('All segments cleared', 'success');
                }
            });
        });

        $("#hoverToggleBtn").click(function() {
            hoverEnabled = !hoverEnabled;
            $(this).text(hoverEnabled ? 'Disable Hover' : 'Enable Hover');
            $(this).toggleClass('active');
            
            showToast(hoverEnabled ? 'Hover mode enabled' : 'Hover mode disabled', 'info');
        });

        $(".segment, .dp").click(function() {
            if (!hoverEnabled) {
                toggleSegment($(this));
            }
        });

        $(".segment, .dp").hover(debounce(function() {
            if (hoverEnabled) {
                toggleSegment($(this));
            }
        }, 50), function() {});

        function debounce(func, wait) {
            let timeout;
            return function(...args) {
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(this, args), wait);
            };
        }

        function toggleSegment(segmentElement) {
            var pcb = segmentElement.data('pcb');
            var segment = segmentElement.data('segment');
            $.post('/toggle_segment', { pcb: pcb, segment: segment }, function(response) {
                if (response.success) {
                    segmentElement.toggleClass('on');
                }
            });
        }

        // Preset management functionality
        $("#savePresetBtn").click(function() {
            const name = $("#presetName").val().trim();
            if (!name) {
                showToast('Please enter a preset name', 'warning');
                return;
            }

            $.post('/save_preset', { name: name }, function(response) {
                if (response.success) {
                    // Update preset dropdown
                    updatePresetDropdown(response.presets);
                    $("#presetName").val('');
                    showToast(`Preset "${name}" saved successfully`, 'success');
                } else {
                    showToast(`Error: ${response.error}`, 'error');
                }
            });
        });

        $("#loadPresetBtn").click(function() {
            const name = $("#presetSelect").val();
            if (!name) {
                showToast('Please select a preset', 'warning');
                return;
            }

            $.post('/load_preset', { name: name }, function(response) {
                if (response.success) {
                    // Update all segments based on loaded state
                    $(".segment, .dp").removeClass('on');
                    response.grid.forEach((pcb, pcbIndex) => {
                        pcb.forEach((state, segmentIndex) => {
                            if (state === 1) {
                                $(`.segment[data-pcb="${pcbIndex}"][data-segment="${segmentIndex}"], .dp[data-pcb="${pcbIndex}"][data-segment="${segmentIndex}"]`).addClass('on');
                            }
                        });
                    });
                    showToast(`Preset "${name}" loaded`, 'success');
                } else {
                    showToast(`Error: ${response.error}`, 'error');
                }
            });
        });

        $("#deletePresetBtn").click(function() {
            const name = $("#presetSelect").val();
            if (!name) {
                showToast('Please select a preset', 'warning');
                return;
            }

            if (confirm(`Are you sure you want to delete preset "${name}"?`)) {
                $.post('/delete_preset', { name: name }, function(response) {
                    if (response.success) {
                        updatePresetDropdown(response.presets);
                        showToast(`Preset "${name}" deleted`, 'info');
                    } else {
                        showToast(`Error: ${response.error}`, 'error');
                    }
                });
            }
        });

        function updatePresetDropdown(presets) {
            const $select = $("#presetSelect");
            $select.empty();
            $select.append($('<option>', {
                value: '',
                text: 'Select a preset...'
            }));
            presets.forEach(preset => {
                $select.append($('<option>', {
                    value: preset,
                    text: preset
                }));
            });
        }
    </script>
</body>
</html>
